<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <title>ImageImportEditor</title>
    <meta name="title" content="ImageImport-Editor" />
    <meta name="description" content="ImageImport-Editor - prepare Import-Scripts for imageimport" />
    <meta name="keywords" content="JSON, Image-Import, Preparation" />
    <meta name="language" content="de" />

    <!--<base href="http://www.michas-ausflugstipps.de/">-->
    <script src="http://www.michas-ausflugstipps.de/./jqplot/jquery.min.js" type="text/javascript"></script>
    <script src="http://www.michas-ausflugstipps.de/./jsres/JMATAllIn.js" type="text/javascript"></script>

<script type="text/javascript">
    /**
     * <h4>FeatureDomain:</h4>
     *     imagemanagement
     *
     * <h4>FeatureDescription:</h4>
     *     software for management of imagefiles
     * 
     * @author Michael Schreiner <ich@michas-ausflugstipps.de>
     * @category imagemanagement
     * @copyright Copyright (c) 2005-2014, Michael Schreiner
     * @license http://mozilla.org/MPL/2.0/ Mozilla Public License 2.0
     *
     * This Source Code Form is subject to the terms of the Mozilla Public
     * License, v. 2.0. If a copy of the MPL was not distributed with this
     * file, You can obtain one at http://mozilla.org/MPL/2.0/.
     */

    /* 
     * ########################################
     * ###
     * ### Toolbox 
     * ###
     * ######################################## 
     */

     function ucFirstAllWords(str) {
         var pieces = str.split(" ");
         for (var i = 0; i < pieces.length; i++ ) {
             var j = pieces[i].charAt(0).toUpperCase();
             pieces[i] = j + pieces[i].substr(1).toLowerCase();
         }
         return pieces.join(" ");
     }
     
     function downloadAsFile($link, data, fileName, mime, encoding) {
         if (mime == "undefind") {
             mime = "application/text";
         }
         if (encoding == "undefind") {
             mime = "uft-8";
         }
         // data URI
         var dataURI = 'data:' + mime + ';charset=' + encoding + ','
                 + encodeURIComponent(data);

         // set link
         var flgSafeMode = 1;
         if (   (navigator.userAgent.indexOf("Trident") >= 0) 
             || (navigator.userAgent.indexOf("MSIE") >= 0)
             || flgSafeMode) {
            // IE or SafeMode
            var popup = window.open("");
            $(popup.document.body).html("<pre>" + data + "</pre>");
            return false;
        } else {
             // all expect IE
             $link.attr({
                 'download' : fileName,
                 'href' : dataURI,
                 'target' : '_blank'
             });
        }
     }
     

     function addKeywordText(elementName, keyword) {
         var str = keyword;
         str = str.replace(/<\/?.*?\/?>/g, String.fromCharCode(13));
         var newText = document.createTextNode(str);
         var field = document.getElementById(elementName);
         field.value = field.value + keyword;
     }    
     
     function formatGpxDateAsString(gpxDate) {
         var strDate = gpxDate.split("T")[0];
         var dateParts = strDate.split("-");
         var date = dateParts[2] + "." + dateParts[1] + "." + dateParts[0];
         var strTime = gpxDate.split("T")[1];
         var time = strTime.split("Z")[0];
         return date + " " + time;
     }
     
     function calcDate(date, timeCorrector) {
        if (! timeCorrector) {
           return date;
        }
        return new Date(date.getTime() + timeCorrector);
     }
     
     function parseGermanDateTime(strGermanDate) {
         var strDate = strGermanDate.split(" ")[0];
         var dateParts = strDate.split(".");
         var strTime = strGermanDate.split(" ")[1];
         var timeParts = strTime.split(":");
         return new Date(dateParts[2], dateParts[1], dateParts[0], 
                         timeParts[0], timeParts[1], timeParts[2]);
     }
     
     function formatGermanDateTime(date) {
        return padNumber(date.getDate(), 2) 
                 + "." + padNumber(date.getMonth(), 2) 
                 + "." + date.getFullYear() 
                 + " " + padNumber(date.getHours(), 2) 
                 + ":" + padNumber(date.getMinutes(), 2) 
                 + ":" + padNumber(date.getSeconds(), 2);
     }
     
     function correctGermanDateTime(strGermanDate, timeCorrector) {
        var date = parseGermanDateTime(strGermanDate);
        var newDate = calcDate(date, timeCorrector);
        return formatGermanDateTime(newDate);
     }
     
    function padNumber(number, count) {
        var r = String(number);
        while ( r.length < count) {
           r = '0' + r;
        }
        return r;
    }

     
     /* 
      * ########################################
      * ###
      * ### Form-Elements
      * ###
      * ######################################## 
      */
     
     function appendShowText(config, $parent, configField, id, data, content) {
         var name = configField["name"];
         var required = configField["required"];
         var tooltip = configField["tooltip"];
         var labelName = ucFirstAllWords(name);
         var $label = appendLabel4Element($parent, "labelinput_" + name + "_" + id,
                 "label_input_text label_input_" + name,
                 labelName, "input_" + name + "_" + id, required, tooltip);

         var classRequired = "";
         if (required != "undefinded" && required) {
             classRequired = " required ";
         }
         var tooltipele = "";
         if (tooltip) {
            tooltipele = " data-tooltip='" + tooltip + "' ";
         }
         $parent.append("<input type='text' "
                 + " id='input_" + name + "_" + id + "'"
                 + " class='input_text input_" + name + classRequired + "'"
                 + " value='" + content + "'" + classRequired
                 + tooltipele
                 + " size='100' readonly/>"
                 );
     }

     function appendInputText(config, $parent, configField, id, data, content) {
         var name = configField["name"];
         var required = configField["required"];
         var labelName = ucFirstAllWords(name);
         var tooltip = configField["tooltip"];
         var $label = appendLabel4Element($parent, "labelinput_" + name + "_" + id,
                 "label_input_text label_input_" + name,
                 labelName, "input_" + name + "_" + id, required, tooltip);

         var classRequired = "";
         if (required != "undefinded" && required) {
             classRequired = " required ";
         }
         var tooltipele = "";
         if (tooltip) {
            tooltipele = " data-tooltip='" + tooltip + "' ";
         }
         $parent.append("<input type='text' "
                 + " id='input_" + name + "_" + id + "'"
                 + " class='input_text input_" + name + classRequired + "'"
                 + " value='" + content + "'" + classRequired
                 + tooltipele
                 + " size='100' />"
                 );
     }

     function getInputText(config, $parent, configField, data) {
         // find field
         var inputFields = $parent.find(".input_" + configField["name"]);

         // iterate blocks from $contentline
         $.each(inputFields, function (index, inputField) {
                 console.log("inputfieldName: " + configField["name"] 
                           + " contentfield:" + index 
                           + " field:" + $(inputField).val());
                 data[configField["name"]] = $(inputField).val();
             }
         );
     }

     function appendInputDate(config, $parent, configField, id, data, content) {
         var name = configField["name"];
         var required = configField["required"];
         var labelName = ucFirstAllWords(name);
         var tooltip = configField["tooltip"];
         var $label = appendLabel4Element($parent, "labelinput_" + name + "_" + id,
                 "label_input_text label_input_" + name,
                 labelName, "input_" + name + "_" + id, required, tooltip);

         var classRequired = "";
         if (required != "undefinded" && required) {
             classRequired = " required ";
         }
         var tooltipele = "";
         if (tooltip) {
            tooltipele = " data-tooltip='" + tooltip + "' ";
         }
         $parent.append("<input type='text' "
                 + " id='input_" + name + "_" + id + "'"
                 + " class='input_date input_" + name + classRequired + "'"
                 + " value='" + content + "'" + classRequired
                 + tooltipele
                 + " size='25' />"
                 );
     }

     function appendInputTextArea(config, $parent, configField, id, data, content, optionalAttributes) {
         var name = configField["name"];
         var required = configField["required"];
         var labelName = ucFirstAllWords(name);
         var tooltip = configField["tooltip"];
         var $label = appendLabel4Element($parent, "labelinput_" + name + "_" + id,
                 "label_input_textarea label_input_" + name,
                 labelName, "input_" + name + "_" + id, required, tooltip);

         var classRequired = "";
         if (required != "undefinded" && required) {
             classRequired = " required ";
         }
         var tooltipele = "";
         if (tooltip) {
            tooltipele = " data-tooltip='" + tooltip + "' ";
         }
         $parent.append("<textarea "
                 + " id='input_" + name + "_" + id + "'"
                 + " class='input_textarea input_textarea_" + name + classRequired + "'"
                 + classRequired
                 + (optionalAttributes ? " " + optionalAttributes + " ": "")
                 + tooltipele
                 + " cols='30' rows='2'>"
                 + content
                 + "</textarea>"
                 );
     }

     function getInputTextArea(config, $parent, configField, data) {
         // find field
         var inputFields = $parent.find(".input_textarea_" + configField["name"]);

         // iterate blocks from $contentline
         $.each(inputFields, function (index, inputField) {
                 console.log("textareafieldName: " + configField["name"] 
                           + " contentfield:" + index 
                           + " field:" + $(inputField).val());
                 data[configField["name"]] = $(inputField).val();
             }
         );
     }

     function appendInputSelectRate(config, $parent, configField, id, data, content) {
         var rates = config.configRates[configField['name'].toUpperCase()];
         var options = "";
         for (var index = 0; index < rates.length; ++index) {
             var rate = rates[index];
             var flgSelected = "";
             if (rate.value == content) {
                 flgSelected = "selected";
             }
             options += "<option value='" + rate.value + "' " + flgSelected + " >"
                     + rate.shortName + " " + rate.longName + "</ option>";
         }

         var name = configField["name"];
         var required = configField["required"];
         var labelName = ucFirstAllWords(name);
         var tooltip = configField["tooltip"];
         var $label = appendLabel4Element($parent, "labelinput_" + name + "_" + id,
                 "label_input_select label_input_" + name,
                 labelName, "input_" + name + "_" + id, required, tooltip);

         var classRequired = "";
         if (required != "undefinded" && required) {
             classRequired = " required ";
         }
         var tooltipele = "";
         if (tooltip) {
            tooltipele = " data-tooltip='" + tooltip + "' ";
         }
         $parent.append("<select "
                 + " id='input_" + name + "_" + id + "'"
                 + " class='input_select input_select_" + name + classRequired + "'"
                 + classRequired
                 + tooltipele
                 + " value='" + content + "'>"
                 + options
                 + "</select>"
                 );
     }

     function getInputSelectRate(config, $parent, configField, data) {
         // find field
         var inputFields = $parent.find(".input_select_" + configField["name"]);

         // iterate blocks from $contentline
         $.each(inputFields, function (index, inputField) {
                 console.log("inputfieldName: " + configField["name"] 
                            + " contentfield:" + index 
                            + " field:" + $(inputField).val());
                 data[configField["name"]] = $(inputField).val();
             }
         );
     }

     function appendInputText4Keywords(config, $parent, configField, id, data, content) {
         // append input
         appendInputTextArea(config, $parent, configField, id, data, content);
         // append url
         $parent.append("<a href='#' onclick=\"javascript:editKeywords('" + id + "'); return false;\""
                 + " class='button' data-tooltip='Auswahl der Schlüsselworte aus einer eigenen Tag-Bibliothek'>Edit</a>");
     }

     function appendInputText4Name(config, $parent, configField, id, data, content) {
         // append input
         appendInputText(config, $parent, configField, id, data, content);
         // append url
         $parent.append("<a href='#' onclick=\"javascript:recalcName('" + id + "'); return false;\""
                 + " class='button' data-tooltip='Berechnung des Namens aus Präfix, Typ, Ort, Personen und Startdatum des Ausflugs'>Recalc</a>");
     }

     function appendInputText4Path(config, $parent, configField, id, data, content) {
         // append show
         appendShowText(config, $parent, configField, id, data, content);

         // append url
         $parent.append(" <a href='#' onclick=\"javascript:openImagePath('" + id + "'); return false;\""
                 + " class='button' data-tooltip='Anzeige des Bildpfades im rechten Fensterteil'>Bilder</a>");
     }

     function appendInputText4TrackFile(config, $parent, configField, id, data, content) {
         // append show
         appendInputText(config, $parent, configField, id, data, content, " wrap='off' ");

         // append url
         $parent.append("<span id='span_TrackFileUploader_" + id + "' class='span_TrackFileUploader'"
                 + " data-tooltip='Upload der Garmin-GPS-Datei per Drag&Drop'>Drag&Drop TrackUploader</span>");

         // Setup the Trackfile-Listener
         var dropZone = document.getElementById("input_TrackFile_" + id);
         dropZone.addEventListener('dragover', handleTrackFileDragOver, false);
         dropZone.addEventListener('drop', handleTrackFileSelect, false);
         dropZone = document.getElementById("span_TrackFileUploader_" + id);
         dropZone.addEventListener('dragover', handleTrackFileDragOver, false);
         dropZone.addEventListener('drop', handleTrackFileSelect, false);     }

     function appendInputText4Track(config, $parent, configField, id, data, content) {
         // append show
         appendInputTextArea(config, $parent, configField, id, data, content, " wrap='off' ");

         // append url
         $parent.append(" <a href='#' onclick=\"javascript:openTrackMap('" + id + "'); return false;\" "
                 + " class='button' data-tooltip='Anzeige des Tracks auf der Karte mit Höhenprofil im rechten Fensterteil'>Map</a>"
                 + "<a href='#' onclick=\"javascript:syncTrackData('" + id + "'); return false;\""
                 + " class='button' data-tooltip='Zurücklesen der Trackdaten aus dem rechten Fensterteil in die Trackfelder (Distance, Aufstieg usw.)'>Sync</a>");

         // Setup the Trackfile-Listener
         var dropZone = document.getElementById("input_Track_" + id);
         dropZone.addEventListener('dragover', handleTrackFileDragOver, false);
         dropZone.addEventListener('drop', handleTrackFileSelect, false);
     }

     function appendInputText4DateSync(config, $parent, configField, id, data, content) {
         // append show
         appendShowText(config, $parent, configField, id, data, content);
         
         // calc names
         var name = configField['name'];
         var track = "input_" + name + "_" + id;
         name = name.replace(/Track/g, "My");
         var my = "input_" + name + "_" + id;

         // append url
         $parent.append(" <a href='#' onclick=\"javascript:$('#" + my + "').val($('#" + track + "').val()); return false;\""
                  + " class='button' data-tooltip='Sync des Trackdatums in die unter Config stehenden Datumsfelder'>-&gt;My</a>");
     }

     
     /* 
      * ########################################
      * ###
      * ### Visualize Data
      * ###
      * ######################################## 
      */
      function genTableHead(config, $container) {
          // init Table
          appendHeadLine(config, $container);
          $container.append("<div id='headLineDummy' class='headLineDummy'> </div>");
      }

     function appendHeadLine(config, $parent) {
         // init vars
         var lstConfigBlocks = config.configBlocks;

         // append new line
         var $container = appendDiv4Element($parent, "head_line", "head_line", "");

         // iterate datablocks
         for (var blockName in lstConfigBlocks) {
             // append datablocks
             appendHeadLine4Block(config, $container, blockName);
         }

         // return new line-JqueryObj
         return $container;
     }

     function appendHeadLine4Block(config, $parent, blockName) {
         // init vars
         var lstConfigFields = config.configBlocks[blockName];

         // append new block
         var $container = appendDiv4Element($parent, "head_block_" + blockName,
                 "head_block " + " block_" + blockName + " head_block_" + blockName,
                 "");

         // iterate fields
         for (var index = 0; index < lstConfigFields.length; ++index) {
             var fieldConfig = lstConfigFields[index];

             // append field
             var $element = appendHeadElement4Field(config, $container, fieldConfig);
         }

         // return new block-JqueryObj
         return $container;
     }

     function appendHeadElement4Field(config, $parent, fieldConfig) {
         var name = fieldConfig["name"];
         var labelName = ucFirstAllWords(name);
         var $label = appendLabel4Element($parent, "label_head_column_" + name,
                 "label_head_column label_column_" + name + " label_head_column_" + name,
                 labelName);
         var $element = appendDiv4Element($parent, "head_column_" + name,
                 "head_column column_" + name + " head_column_" + name,
                 labelName);
         return $element;
     }

     function genTableContent(config, $container, dataContainer) {
         // iterate data
         for (var index = 0; index < dataContainer.data.length; ++index) {
             var data = dataContainer.data[index];

             // append line
             var $element = appendContentLine(config, $container, index+1, data);
         }
     }

     function appendContentLine(config, $parent, id, data) {
         // init vars
         var lstConfigBlocks = config.configBlocks;

         // append new line
         var $container = appendDiv4Element($parent, "content_line_" + id, "content_line", "");
         
         // append new ue
         var name = data[config.configName];
         var $ueContainer = appendDiv4Element($container, "content_line_ue_" + id, 
                "content_line_ue", name);
         
         // append new dataContainer
         var $dataContainer = appendDiv4Element($container, "content_line_datacontainer_" + id, 
                "content_line_datacontainer", "");

         // iterate datablocks
         for (var blockName in lstConfigBlocks) {
             // append datablocks
             appendContentLine4Block(config, $dataContainer, blockName, id, data);
         }
         
         // append Toggler
         jMATService.getPageLayoutService().appendBlockToggler("content_line_ue_" + id, 
                "content_line_datacontainer_" + id);

         // return new line-JqueryObj
         return $container;
     }

     function appendContentLine4Block(config, $parent, blockName, id, data) {
         // init vars
         var lstConfigFields = config.configBlocks[blockName];

         // append new block
         var $container = appendDiv4Element($parent, "content_block_" + blockName + "_" + id,
                 "content_block " + " block_" + blockName + " content_block_" + blockName,
                 "");

         // append new ue
         var $ueContainer = appendDiv4Element($container, "content_block_ue_" + id, 
                "content_block_ue", ucFirstAllWords(blockName));

         // iterate fields
         for (var index = 0; index < lstConfigFields.length; ++index) {
             // get fieldConfig
             var fieldConfig = lstConfigFields[index];

             // append generated field
             var $element = appendContentElement4Field(config, $container, fieldConfig, id, data);
         }

         // return new block-JqueryObj
         return $container;
     }

     function appendContentElement4Field(config, $parent, fieldConfig, id, data) {
         // init vars
         var fieldName = fieldConfig["name"];
         var funcRef = fieldConfig["editor"];
         var defaultValue = fieldConfig["defaultvalue"];

         // read content
         var content = data[fieldName];
         if (content == "undefined" || content == undefined) {
             if (defaultValue) {
                content = defaultValue;
             } else {
                content = "";
             }
         }

         // append new field
         var $element = appendDiv4Element($parent, "content_column_" + fieldName + "_" + id,
                 "content_column column_" + fieldName + " content_column_" + fieldName, "");

         // insert content (input or data)
         if (funcRef != null) {
             content = funcRef(config, $element, fieldConfig, id, data, content);
         } else {
             $element.append(content);
         }

         // return new field-JqueryObj
         return $element;
     }


     function appendDiv4Element($parent, id, styleClass, content) {
         // create new html-Element
         var str = "<div id='" + id + "' class='" + styleClass + "'>" 
                 + content + "</div>";

         // append to Parent
         var $element = $(str).appendTo($parent);
         return $element;
     }

     function appendLabel4Element($parent, id, styleClass, content, parent, required, tooltip) {
         var classRequired = "";
         if (required != "undefinded" && required) {
             classRequired = " required ";
         }

         // create new html-Element
         var tooltipele = "";
         if (tooltip) {
            tooltipele = " data-tooltip='" + tooltip + "' ";
         }
         var str = "<label id='" + id + "' class='label " + styleClass + classRequired + "' "
                 + "for='" + parent + "' "+ tooltipele + ">" + content + "</label>";

         // append to Parent
         var $element = $(str).appendTo($parent);
         return $element;
     }

     /* 
      * ########################################
      * ###
      * ### Services
      * ###
      * ######################################## 
      */
     function editKeywords(id) {
         // field to setup
         var srcElementId = "input_Keywords_" + id;

         // get keywordsDiv
         var $keywordsDiv = $("#divKeywordsEditor");
         $keywordsDiv.css("top", "160px");
         $keywordsDiv.css("left", "10px");
         $keywordsDiv.css("display", "block");
         
         // open editor
         openKeywordEditor($keywordsDiv, srcElementId, null, null);
         
     }
         
     function recalcName(id) {
         // field to setup
         var $name = $("#input_Name_" + id);

         // config fields
         var praefix = $("#input_Praefix_" + id).val();
         var selector = "#input_Type_" + id + " option:selected";
         var type = $(selector).text();
         var startDate = $("#input_MyStartDate_" + id).val().substring(0, 10);
         var endDate = $("#input_MyEndDate_" + id).val().substring(0, 10);
         var ort = $("#input_MyOrt_" + id).val();
         var personen = $("#input_Personen_" + id).val();

         var newName = "";
         if (praefix != "") {
             newName += praefix + ": ";
         }
         if (type != "") {
             type = type.substring(type.indexOf(" ") + 1, type.length);
             newName += type;
         }
         if (personen != "") {
             newName += " mit " + personen;
         }
         if (ort != "") {
             newName += " bei " + ort;
         }
         if (startDate == endDate) {
             newName += " " + startDate;
         } else {
             newName += " " + startDate + "-" + endDate;
         }
         
         // set new name
         $name.val(newName);
         
         return newName;
     }
     
     function openImagePath(id) {
         // field to setup
         var $path = $("#input_Path_" + id);
         var newPath = $path.val();
         newPath = newPath.replace(/\\/g, "/");
         newPath = "file:///" + newPath;
         
         // open Frame
         document.getElementById('images').src=newPath;
         
         // toggle visibility
         document.getElementById('images').style.display='block';
         document.getElementById('mapContainer').style.display='none';
     }

     function openTrackMap(id) {
         // field to setup
         var $track = $("#input_Track_" + id);
         var newTrack = $track.val();

         // toggle visibility
         document.getElementById('images').style.display='none';
         document.getElementById('mapContainer').style.display='block';
         
         loadMap(newTrack);
     }
     
     function syncTrackData(id) {
        $("#input_AltAsc_" + id).val($("#data_asc").html());
        $("#input_AltDesc_" + id).val($("#data_desc").html());
        $("#input_Dist_" + id).val($("#data_dist").html());
        $("#input_AltMin_" + id).val($("#data_min").html());
        $("#input_AltMax_" + id).val($("#data_max").html());
        $("#input_AltStart_" + id).val($("#data_elestart").html());
        $("#input_AltEnd_" + id).val($("#data_eleend").html());
        $("#input_TrackStartDate_" + id).val(
            correctGermanDateTime(
                $("#data_datestart").html(), 
                $("#input_TrackTimeCorrector_" + id).val() * 60 * 60 * 1000));
        $("#input_TrackEndDate_" + id).val(
            correctGermanDateTime(
                $("#data_dateend").html(), 
                $("#input_TrackTimeCorrector_" + id).val() * 60 * 60 * 1000));
     }
     

     /* File-Drag&Drop&Read inspired by http://www.html5rocks.com/de/tutorials/file/dndfiles/ */
     function handleTrackFileSelect(evt) {
        evt.stopPropagation();
        evt.preventDefault();

        // iterate files
        var files = evt.dataTransfer.files;
        for (var i = 0, f; f = files[i]; i++) {
            
            console.log("load File:" + f.name);
        
            // instantiate FileReader
            var reader = new FileReader();
            reader.onload = (function(theFile) {
                return function(e) {
                    // set new Track
                    console.log("new track: " + e.target.result);
                    
                    // get id
                    var eleId = evt.target.id;
                    var id = eleId;
                    id = id.replace(/input_TrackFile_/g, "");
                    id = id.replace(/input_Track_/g, "");
                    id = id.replace(/span_TrackFileUploader_/g, "");
                    
                    // format track
                    var track = e.target.result;
                    track = track.replace(/<trkpt /g, "\n<trkpt ");
                    // set result
                    $("#input_Track_" + id).val(track);
                    $("#input_TrackFile_" + id).val(theFile.name);
                    
                    // openMap
                    openTrackMap(id);
                };
            })(f);

            // Read the new Tracks as Text
            reader.readAsText(f);        
        }
     } 
    
     function handleTrackFileDragOver(evt) {
        // Explicitly show this is a copy.
        evt.stopPropagation();
        evt.preventDefault();
        evt.dataTransfer.dropEffect = 'copy';
     }    


    /* 
      * ########################################
      * ###
      * ### Load Data
      * ###
      * ######################################## 
      */
      function loadDataFromServer(url) {
         // load per JSon
         console.log( "load:" + url);
         $.getJSON( url, function ( data ) {
                 console.log( "done 1: " + url);

                 // init items
                 var items = new Array();

                 // iterate items
                 $.each( data, function(number, item ) {
                         // add items
                         items.push(item);
                     }
                 );

                 // set dataContainer array and flag
                 dataContainer.data = items;
                 dataContainer.flgDataLoaded = true;
                 
                 // initApp
                 initApp();
             }
         ).done(function(obj, msg) {
                 // second success
                 console.log( "done 2: " + url);
             }
         ).fail(function(jqxhr, textStatus, error) {
                 // error handling
                 console.log( "error: " + url + " msg:" + error);
             }
         ).always(function(msg) {
                 // full complete
                 console.log( "complete: " + url + " msg:" + msg);
             }
         );
     }

     function handleImportJSONFileSelect(evt) {
         var files = evt.target.files; // FileList object

         // Loop through the FileList.
         for (var i = 0, numFiles = files.length; i < numFiles; i++) {
             var file = files[i];
             var reader = new FileReader();

             // config reader
             reader.onload = function(res) {
                 console.log("read fileName:" + file.name);
                 var data = jQuery.parseJSON( res.target.result );

                 // init items
                 var items = new Array();
                 $.each( data, function(number, item ) {
                         // add items
                         items.push(item);
                     }
                 );

                 // set dataContainer array and flag
                 dataContainer.data = items;
                 dataContainer.flgDataLoaded = true;
                 
                 // initApp
                 initApp();
             };

             // read the file
             reader.readAsText(file);
             
             i = files.length +1000;
         }
     }

     /* 
      * ########################################
      * ###
      * ### Extract Data
      * ###
      * ######################################## 
      */
     function extractTableContent(configContainer, $container, dataContainer) {
         // init vars
         var data = new Array();
         dataContainer.data = data;

         // find contentlines for $container
         var contentLines = $container.find(".content_line_datacontainer");
         console.log("contentlines:" + contentLines.length + " contentLines:"
                 + contentLines);

         // iterate lines from $container
         $.each(contentLines, function(index, contentLine) {
             console.log("contentline:" + index + " line:" + $(contentLine));
             extractLineContent(configContainer, $(contentLine), dataContainer);
         });

         // return data-list
         return dataContainer.data;
     }

     function extractLineContent(configContainer, $contentline, dataContainer) {
         // init vars
         var dataObj = {};

         // init vars
         var lstConfigBlocks = configContainer.configBlocks;

         // iterate datablocks
         for ( var blockName in lstConfigBlocks) {
             // find contentblock for $contentline
             var contentBlocks = $contentline.find(".content_block_" + blockName);

             // iterate blocks from $contentline
             $.each(contentBlocks, function(index, contentBlock) {
                 console.log("block: " + blockName + " contentblock:" + index
                         + " block:" + $(contentBlock));
                 extractBlockContent(configContainer, $(contentBlock),
                         blockName, dataObj);
             });

         }

         // add data to dataContainer
         dataContainer.data.push(dataObj);

         // return data-obj
         return dataObj;
     }

     function extractBlockContent(configContainer, $contentblock, blockName, data) {
         // init vars
         var lstConfigFields = configContainer.configBlocks[blockName];

         // iterate fields
         for ( var index = 0; index < lstConfigFields.length; ++index) {
             // get fieldConfig
             var fieldConfig = lstConfigFields[index];
             extractFieldContent(configContainer, $contentblock, fieldConfig,
                     data);
         }

         // return data-obj
         return data;
     }

     function extractFieldContent(configContainer, $contentblock, fieldConfig, data) {
         // init vars
         var fieldName = fieldConfig["name"];
         var funcRef = fieldConfig["getter"];

         // find field
         var contentFields = $contentblock.find(".content_column_" + fieldName);

         // iterate blocks from $contentline
         $.each(contentFields,
             function(index, contentField) {
                 console.log("fieldName: " + fieldName + " contentfield:"
                         + index + " field:" + $(contentField));
     
                 // get content (input or data)
                 if (funcRef != null) {
                     content = funcRef(configContainer, $(contentField),
                             fieldConfig, data);
                 } else {
                     data[fieldName] = $(contentField).html();
                 }
                 console.log("fieldName: " + fieldName + " data:"
                         + data[fieldName]);
             }
         );

         // return data-obj
         return data;
     }
     
     function jsonReplacer(key, value) {
        //console.log("key:" + key + "=" + value);
        if (typeof value === "string") {
           value = value.replace(/\</g, "&lt;");
           value = value.replace(/\>/g, "&gt;");
        }
        return value;
     }

     function downloadAsJSON($link, data, fileName) {
         // data
         var json = JSON.stringify(data, jsonReplacer);
         
         // update link
         downloadAsFile($link, json, fileName, "application/json", "utf-8");
     }

     function downloadAsBatchFile($link, data, fileName) {
         // data
         var bat = "";

         // template java -Xmx512m -Xms128m -Dfile.encoding=ISO8859_1  -cp  %CP% org.plontke.webapp.mediadb.jobs.ImportImages %CONF% "Besichtigung des Kuhstall 24.03.2008" "24.03.2008 13:30:00" "24.03.2008 14:30:59" "OFFEN,Ausflug,Micha,Kuhstall,,KW_Winter,KW_heiter,KW_Schnee,KW_Sonne,KW_sonnig,KW_Kurztour,KW_Wanderung,KW_Wandern,KW_Naturlandschaft,KW_Bergwald,KW_Wald,KW_Berge,KW_Felsen,KW_Felswand,KW_Mittelgebirge,KW_Schlucht,KW_Tal" "D:\Bilder\digifotos\import-2008-03\20080324-kuhstall" "Kuhstall"
         for ( var index = 0; index < data.length; ++index) {
             var dataObj = data[index];
             bat += "java -Xmx512m -Xms128m -Dfile.encoding=ISO8859_1  -cp  %CP% org.plontke.webapp.mediadb.jobs.ImportImages %CONF% "
                 + " \"" + dataObj["Name"] + "\""
                 + " \"" + dataObj["MyStartDate"] + "\""
                 + " \"" + dataObj["MyEndDate"] + "\""
                 + " \"" + dataObj["Keywords"] + "\""
                 + " \"" + dataObj["Path"].replace(/\//g, "\\") + "\"" 
                 + " \"" + dataObj["MyOrt"] + "\"" + "\n";
         }

         // update link
         downloadAsFile($link, bat, fileName, "application/text", "utf-8");
     }

     function downloadAsSqlFile($link, data, fileName, config) {
         // data
         var sql = "";
         
         // configure UpdateFields
         var lstDBUpdateFields =  new Array();        
         lstDBUpdateFields.push('K_NAME');
         lstDBUpdateFields.push('K_DISTANCE');
         lstDBUpdateFields.push('K_ALTITUDE_MIN');
         lstDBUpdateFields.push('K_ALTITUDE_MAX');
         lstDBUpdateFields.push('K_ALTITUDE_ASC');
         lstDBUpdateFields.push('K_ALTITUDE_DESC');
         lstDBUpdateFields.push('K_TYPE');
         lstDBUpdateFields.push('K_RATE_SCHWIERIGKEIT');
         lstDBUpdateFields.push('K_RATE_AUSDAUER');
         lstDBUpdateFields.push('K_RATE_KRAFT');
         lstDBUpdateFields.push('K_RATE_MENTAL');
         lstDBUpdateFields.push('K_RATE_BILDUNG');
         lstDBUpdateFields.push('K_RATE_MOTIVE');
         lstDBUpdateFields.push('K_RATE_WICHTIGKEIT');
         lstDBUpdateFields.push('K_RATE_GESAMT');

         // configure Mapping
         var hshMapping = new Array();
         var lstConfigBlocks = config.configBlocks;
         // iterate datablocks
         for (var blockName in lstConfigBlocks) {
             var lstConfigFields = config.configBlocks[blockName];
             // iterate fields
             for (var index = 0; index < lstConfigFields.length; ++index) {
                 // get fieldConfig
                 var fieldConfig = lstConfigFields[index];
                 // add to hshMapping
                 if (fieldConfig.sqlname && fieldConfig.sqlname != "undefined") {
                     hshMapping[fieldConfig.sqlname] = fieldConfig.name;
                 }
             }
         }

         for ( var index = 0; index < data.length; ++index) {
             var dataObj = data[index];
             var mysql = "update KATEGORIE set  ";
             
             // iterate fields and add sql
             for (var index2 = 0; index2 < lstDBUpdateFields.length; ++index2) {
                 // get fieldConfig
                 var dbFieldName = lstDBUpdateFields[index2];
                 if (hshMapping[dbFieldName] && hshMapping[dbFieldName] != "undefined") {
                     mysql += " " + dbFieldName + "='" + dataObj[hshMapping[dbFieldName]] + "',";
                 }
             }
             // trim last ","
             mysql = mysql.replace(/\,$/, "");
             mysql += " where K_ID in (select distinct K_ID from IMAGES where I_ORIGPATH like \"" + dataObj["Path"].replace(/\\/g, "/") + "/%\")" 
                 + ";\n";
                 
             sql += mysql;
         }

         // update link
         downloadAsFile($link, sql, fileName, "application/text", "utf-8");
     }
     
     /* 
      * ########################################
      * ###
      * ### Keyword Editor 
      * ###
      * ######################################## 
      */
  
     function initKeywordsEditor(config, $container) {
         // init config
         var configKeywordBlocks = config.configKeywords;

         // iterate blocks
         for (var blockName in configKeywordBlocks) {
             // get config
             var configKeywords = configKeywordBlocks[blockName];
              
             // configure line
             var line = "<div class='rowStart_container'>"
                      + "<label class='label_container'>" + blockName + "</label>"
                      + "<div class='textShow_container'>";
              
             // iterate keywords
             for (var index = 0; index < configKeywords.length; ++index) {
                 var keyword = configKeywords[index];
                 line += "<a class='a-addkeyword a-addkeyword-KW_" + keyword + "'"
                      + " href='#' id='a_addkeyword_KW_" + keyword + "'>"
                      + keyword + "</a> ";
             }
              
             // end line
             line += "</div></div>";

             // append to container
             $container.append(line);
         }
     }

     function openKeywordEditor($keywordsDiv, srcElementId, requiredElementId, suggestedElementId) {
         var srcKeywords = $("#" + srcElementId);
         var requiredKeywords = $("#" + requiredElementId);
         var suggestedKeywords = $("#" + suggestedElementId);
         
         // reset color of all keyword-links
         $("#" + $keywordsDiv.attr('id') + " a").filter(".a-addkeyword").css("color", "blue");

         // check all keyword-links
         $.each($("#" + $keywordsDiv.attr('id') + " a").filter(".a-addkeyword"), 
             function (index, kwLink) {
                 // extract keyword-text
                 var keyword = $(kwLink).text();
     
                 // change onclick of link to current srcKeywords
                 kwLink.onclick = function(event, link) {
                     addKeywordText(srcElementId, ',KW_' + keyword);
                     $(kwLink).css("color", "green");
                     return false;
                 };

                 // change color if keyword exists in requiredKeywords
                 if (requiredKeywords) {
                     jMATService.getPageLayoutService().getJMSServiceObj().doActionIfNeedlesFound(
                         $(requiredKeywords).val(), ['KW_' + keyword],
                         function() {
                             $(kwLink).css("color", "red");
                         }
                     );
                 }
                 // change color if keyword exists in suggestedKeywords
                 if (suggestedKeywords) {
                     jMATService.getPageLayoutService().getJMSServiceObj().doActionIfNeedlesFound(
                         $(suggestedKeywords).val(), ['KW_' + keyword],
                         function() {
                             $(kwLink).css("color", "red");
                         }
                     );
                 }
                 // change color if keyword exists in srcKeywords
                 if (srcKeywords) {
                     jMATService.getPageLayoutService().getJMSServiceObj().doActionIfNeedlesFound(
                         $(srcKeywords).val(), ['KW_' + keyword],
                         function() {
                             $(kwLink).css("color", "green");
                         }
                     );
                 }
             }
         );
     }
     
     /* 
      * ########################################
      * ###
      * ### App + Config
      * ###
      * ######################################## 
      */
     function runApp(configContainer, dataContainer) {
         // clear container
         var $container = $("#container");
         $container.empty();

         // gen Table
         genTableHead(configContainer, $container);
         genTableContent(configContainer, $container, dataContainer);

         // activate exportLinks
         $(".exportLink").css("display", "inline");
         document.getElementById("exportJSONLink").onclick = function(event, link) {
                 event.preventDefault();
                 extractTableContent(configContainer, $container, dataContainer);
                 downloadAsJSON($(this), dataContainer.data, 'data.json');
                 return false;
             }
         ;
         document.getElementById("exportBatchLink").onclick = function(event, link) {
                 extractTableContent(configContainer, $container, dataContainer);
                 downloadAsBatchFile($(this), dataContainer.data, 'data.bat');
                 event.preventDefault();
                 return false;
             }
         ;
         document.getElementById("exportSqlLink").onclick = function(event, link) {
                 extractTableContent(configContainer, $container, dataContainer);
                 downloadAsSqlFile($(this), dataContainer.data, 'update.sql', configContainer);
                 event.preventDefault();
                 return false;
             }
         ;
         
         // init keywordseditor
         initKeywordsEditor(configContainer, $("#divKeywordsEditor"));
     }

     function loadConfig(configContainer) {
         // init Config
         initConfigBlocks(configContainer);
         initConfigRates(configContainer);
         initConfigKeywords(configContainer);

         // initFileUploader
         var fileDialog = document.getElementById('importJSONFile');
         fileDialog.addEventListener('change', handleImportJSONFileSelect, false);
     }

     function initConfigBlocks(configContainer) {
         // set data
         var lstConfigBlocks = {};
         lstConfigBlocks["base"] = new Array();
         lstConfigBlocks["base"].push({ name : "Path", 
                                        editor : appendInputText4Path, getter : getInputText});

         lstConfigBlocks["vorgabe"] = new Array();
         lstConfigBlocks["vorgabe"].push({ name : "Ort"});
         lstConfigBlocks["vorgabe"].push({ name : "StartDate"});
         lstConfigBlocks["vorgabe"].push({ name : "EndDate"});

         lstConfigBlocks["config"] = new Array();
         lstConfigBlocks["config"].push({ name : "Type",
                                          sqlname : 'K_TYPE',
                                          editor : appendInputSelectRate, getter : getInputSelectRate, 
                                          required: true, 
                                          tooltip: "Die Art des Ausflugs (Bootsfahrt...)"});
         lstConfigBlocks["config"].push({ name : "Praefix", 
                                          editor : appendInputText, getter : getInputText, 
                                          tooltip: "Ein eventuelles Präfix für die Berechnung des Ausflugsnamens bei Urlauben z.B. Alpen 2014"});
         lstConfigBlocks["config"].push({ name : "TimeCorrector", 
                                          editor : appendInputText, getter : getInputText, 
                                          tooltip: "Bei zu spät umgestellter Sommer/Winterzeit die Korrektur in Stunden"});
         lstConfigBlocks["config"].push({ name : "MyOrt", 
                                          editor : appendInputText, getter : getInputText, required: true, 
                                          tooltip: "Der Ort des Ausflugs"});
         lstConfigBlocks["config"].push({ name : "MyStartDate", 
                                          sqlname : 'K_DATEVON',
                                          editor : appendInputDate, getter : getInputText, required: true, 
                                          tooltip: "Das Startdatum des Ausflugs (initial berechnet aus den Bildern, kann durch Trackdaten oder manuell angepast werden)."});
         lstConfigBlocks["config"].push({ name : "MyEndDate", 
                                          sqlname : 'K_DATEBIS',
                                          editor : appendInputDate, getter : getInputText, required: true, 
                                          tooltip: "Das Endedatum des Ausflugs (initial berechnet aus den Bildern, kann durch Trackdaten oder manuell angepast werden)."});

         lstConfigBlocks["data"] = new Array();
         lstConfigBlocks["data"].push({ name : "Personen", 
                                        editor : appendInputText, getter : getInputText, 
                                        tooltip: "Am Ausflug beteiligte Personen."});
         lstConfigBlocks["data"].push({ name : "Name", 
                                        sqlname : 'K_NAME',
                                        editor : appendInputText4Name, getter : getInputText, required: true, 
                                        tooltip: "Der Name des Ausflugs (kann auch über Recalc berechnet werden)."});
         lstConfigBlocks["data"].push({ name : "Keywords", 
                                        editor : appendInputText4Keywords, getter : getInputTextArea, required: true, 
                                        tooltip: "Schlüsselworte die den Ausflug beschreiben."});
         lstConfigBlocks["data"].push({ name : "Comment", 
                                        sqlname : 'K_META_SHORTDESC',
                                        editor : appendInputTextArea, getter : getInputTextArea, required: false, 
                                        tooltip: "Ein Kommentar zum Ausflug (darauf fusst später die Beschreibung)."});

         lstConfigBlocks["rate"] = new Array();
         lstConfigBlocks["rate"].push({ name : "GESAMT", 
                                        sqlname : 'K_RATE_GESAMT',
                                        editor : appendInputSelectRate, getter : getInputSelectRate, 
                                        tooltip: "Die Gesamtbewertung des Ausflugs."});
         lstConfigBlocks["rate"].push({ name : "WICHTIGKEIT", 
                                        sqlname : 'K_RATE_WICHTIGKEIT',
                                        editor : appendInputSelectRate, getter : getInputSelectRate, 
                                        tooltip: "Die persönliche Wichtigkeit des Ausflugs."});
         lstConfigBlocks["rate"].push({ name : "MOTIVE",
                                        sqlname : 'K_RATE_MOTIVE',
                                        editor : appendInputSelectRate, getter : getInputSelectRate, 
                                        tooltip: "Die Bewertung der Motive des Ausflugs."});
         lstConfigBlocks["rate"].push({ name : "BILDUNG", 
                                        sqlname : 'K_RATE_BILDUNG',
                                        editor : appendInputSelectRate, getter : getInputSelectRate, 
                                        tooltip: "Die optionale Bewertung der Bildung des Ausflugs."});
         lstConfigBlocks["rate"].push({ name : "SCHWIERIGKEIT",
                                        sqlname : 'K_RATE_SCHWIERIGKEIT',
                                        editor : appendInputSelectRate, getter : getInputSelectRate, 
                                        tooltip: "Die Einschätzung der Gesamtschwierigkeit des Ausflugs."});
         lstConfigBlocks["rate"].push({ name : "AUSDAUER",
                                        sqlname : 'K_RATE_AUSDAUER',
                                        editor : appendInputSelectRate, getter : getInputSelectRate, 
                                        tooltip: "Die Einschätzung der Ausdauer des Ausflugs."});
         lstConfigBlocks["rate"].push({ name : "KRAFT",
                                        sqlname : 'K_RATE_KRAFT',
                                        editor : appendInputSelectRate, getter : getInputSelectRate, 
                                        tooltip: "Die Einschätzung des Kraftaufwandes des Ausflugs."});
         lstConfigBlocks["rate"].push({ name : "MENTAL",
                                        sqlname : 'K_RATE_MENTAL',
                                        editor : appendInputSelectRate, getter : getInputSelectRate, 
                                        tooltip: "Die Einschätzung des mentalen Anspruchs des Ausflugs."});

         lstConfigBlocks["track"] = new Array();
         lstConfigBlocks["track"].push({ name : "TrackFile",
                                         editor : appendInputText4TrackFile, getter : getInputTextArea, required: false, 
                                         tooltip: "Name der zugeordneten Garmin-GPX-Datei mit dem Track (kann per Drag&Drop eingefugegt werden)."});
         lstConfigBlocks["track"].push({ name : "Track",
                                         sqlname : 'K_GPSTRACKS_TXT',
                                         editor : appendInputText4Track, getter : getInputTextArea, required: false, 
                                         tooltip: "Der Inhalt der Garmin-GPX-Datei mit dem Track (kann per Drag&Drop eingefugegt werden)."});
         lstConfigBlocks["track"].push({ name : "TrackTimeCorrector",
                                         editor : appendInputText, getter : getInputText, defaultvalue: "2", 
                                         tooltip: "Der Faktor zur Korrektur der Trackzeit in Stunden beim Track-Sync (GPX-Zeiten sind UTC - default ist 2h für Sommerzeit Mitteleuropa)."});
         lstConfigBlocks["track"].push({ name : "TrackStartDate",
                                         editor : appendInputText4DateSync, getter : getInputText, 
                                         tooltip: "Das aus dem Track berechnete Startdatum des Ausflugs (kann per ->My in das Config-Startdatum übertragen werden)"});
         lstConfigBlocks["track"].push({ name : "TrackEndDate",
                                         editor : appendInputText4DateSync, getter : getInputText, 
                                         tooltip: "Das aus dem Track berechnete Enddatum des Ausflugs (kann per ->My in das Config-Enddatum übertragen werden)"});
         lstConfigBlocks["track"].push({ name : "Dist",
                                         sqlname : 'K_DISTANCE',
                                         editor : appendInputText, getter : getInputText, 
                                         tooltip: "Die aus dem Track berechnete zurückgelegte Entfernung in km."});
         lstConfigBlocks["track"].push({ name : "AltMin",
                                         sqlname : 'K_ALTITUDE_MIN',
                                         editor : appendInputText, getter : getInputText, 
                                         tooltip: "Die aus dem Track berechnete minimale Höhe in m."});
         lstConfigBlocks["track"].push({ name : "AltMax",
                                         sqlname : 'K_ALTITUDE_MAX',
                                         editor : appendInputText, getter : getInputText, 
                                         tooltip: "Die aus dem Track berechnete maximale Höhe in m."});
         lstConfigBlocks["track"].push({ name : "AltAsc",
                                         sqlname : 'K_ALTITUDE_ASC',
                                         editor : appendInputText, getter : getInputText, 
                                         tooltip: "Der aus dem Track berechnete Aufstieg in Hm."});
         lstConfigBlocks["track"].push({ name : "AltDesc",
                                         sqlname : 'K_ALTITUDE_DESC',
                                         editor : appendInputText, getter : getInputText, 
                                         tooltip: "Der aus dem Track berechnete Abstieg in Hm."});
         lstConfigBlocks["track"].push({ name : "AltStart",
                                         editor : appendInputText, getter : getInputText, 
                                         tooltip: "Der aus dem Track berechnete Starthöhe in m."});
         lstConfigBlocks["track"].push({ name : "AltEnd",
                                         editor : appendInputText, getter : getInputText, 
                                         tooltip: "Der aus dem Track berechnete Zielhöhe in m."});


         // set config
         configContainer.configBlocks = lstConfigBlocks;
         configContainer.flgConfigBlocksLoaded = true;
     }

     function initConfigKeywords(configContainer) {
         // set data
         var lstConfigKeywords = {};
         lstConfigKeywords['Wald'] = new Array('Bergwald', 'Laubwald', 'Nadelwald', 'Strandwald', 'Wald');
         lstConfigKeywords['Gebirge'] = new Array('Berge', 'Felsen', 'Felswand', 'Firn', 'Gletscherschau', 'Hochebene', 'Hochgebirge', 'Höhle', 'Mittelgebirge', 'Schlucht', 'Schneefelder', 'Tal');
         lstConfigKeywords['Meer'] = new Array('Meer', 'Ozean', 'Sandstrand', 'Steinstrand', 'Steilküste');
         lstConfigKeywords['Gewässer'] = new Array('Aue', 'Bach', 'Fluss', 'Moor', 'See', 'Seenlandschaft', 'Teich', 'Wasserfall');
         lstConfigKeywords['Wiese'] = new Array('Alm', 'Blumen', 'Feld', 'Heide', 'Kakteen', 'Steppe', 'Weide', 'Wiese', 'Wüste');
         lstConfigKeywords['Stadt'] = new Array('Architektur', 'Basar', 'Burg', 'Denkmal', 'Dom', 'Geschichte', 'Kirche', 'Kunst', 'Moschee', 'Museum', 'Park', 'Ruinen', 'Schloss', 'Tempel', 'Zoo');
         lstConfigKeywords['Stadt/Land'] = new Array('Kulturlandschaft', 'Landschaft', 'Natur', 'Dorf', 'Stadt', 'Naturlandschaft');
         lstConfigKeywords['Aktivität'] = new Array('Baden', 'Boofen', 'Bootfahren', 'Campen', 'Fliegen', 'Gletscherbegehung', 'Kanu', 'Klettern', 'Klettersteig', 'Museumsbesuch', 'Stadtbesichtigung', 'Radfahren', 'Schneeschuhwandern', 'Skaten', 'Wandern');
         lstConfigKeywords['Tour'] = new Array('Besichtigung', 'Gassi', 'Hochtour', 'Spaziergang', 'Wanderung');
         lstConfigKeywords['Dauer'] = new Array('Kurztour', 'Mehrtagestour', 'Tagestour');
         lstConfigKeywords['Wetter'] = new Array('bedeckt', 'Eis', 'heiter', 'Regen', 'Schnee', 'Sonne', 'sonnig');
         lstConfigKeywords['Jahreszeit'] = new Array('Frühling', 'Herbst', 'Sommer', 'Winter');
         lstConfigKeywords['Zeugs'] = new Array('Mond', 'Sonnenaufgang', 'Sonnenuntergang');
         lstConfigKeywords['Dinge'] = new Array('Menschen', 'Technik', 'Tiere');
         
         // set config
         configContainer.configKeywords = lstConfigKeywords;
         configContainer.flgConfigKeywordsLoaded = true;
     }

     function initConfigRates(configContainer) {
         // set data
         var lstConfigRates = {};
         lstConfigRates['I_RATE'] = new Array();
         lstConfigRates['I_RATE'].push({ id: 70, fieldname: 'I_RATE', value: 0, shortName: '_____', longName: 'nicht eingeschätzt'});
         lstConfigRates['I_RATE'].push({ id: 71, fieldname: 'I_RATE', value: 2, shortName: '*____', longName: 'Playlist (autom)'});
         lstConfigRates['I_RATE'].push({ id: 72, fieldname: 'I_RATE', value: 5, shortName: '**___', longName: 'Favorit (autom)'});
         lstConfigRates['I_RATE'].push({ id: 73, fieldname: 'I_RATE', value: 8, shortName: '***__', longName: 'Kat-Favorit (autom)'});
         lstConfigRates['I_RATE'].push({ id: 74, fieldname: 'I_RATE', value: 11, shortName: '****_', longName: 'phantastisch (manuell)'});
         lstConfigRates['I_RATE'].push({ id: 75, fieldname: 'I_RATE', value: 14, shortName: '*****', longName: 'Meilenstein (manuell)'});
         lstConfigRates['I_RATE'].push({ id: 76, fieldname: 'I_RATE', value: 9, shortName: '**+__', longName: 'Kalender-Auswahl (autom)'});
         lstConfigRates['I_RATE'].push({ id: 77, fieldname: 'I_RATE', value: 10, shortName: '**+__', longName: 'Kalender-Favorites (autom)'});
         lstConfigRates['I_RATE'].push({ id: 78, fieldname: 'I_RATE', value: 6, shortName: '*+___', longName: 'Favorit+ (autom)'});
         lstConfigRates['AUSDAUER'] = new Array();
         lstConfigRates['AUSDAUER'].push({ id: 7, fieldname: 'K_RATE_AUSDAUER', value: 0, shortName: '_____', longName: 'nicht eingeschätzt'});
         lstConfigRates['AUSDAUER'].push({ id: 8, fieldname: 'K_RATE_AUSDAUER', value: 2, shortName: '*____', longName: 'problemlos'});
         lstConfigRates['AUSDAUER'].push({ id: 9, fieldname: 'K_RATE_AUSDAUER', value: 5, shortName: '**___', longName: 'kurz'});
         lstConfigRates['AUSDAUER'].push({ id: 10, fieldname: 'K_RATE_AUSDAUER', value: 8, shortName: '***__', longName: 'mittel'});
         lstConfigRates['AUSDAUER'].push({ id: 11, fieldname: 'K_RATE_AUSDAUER', value: 11, shortName: '****_', longName: 'anspruchsvoll'});
         lstConfigRates['AUSDAUER'].push({ id: 12, fieldname: 'K_RATE_AUSDAUER', value: 14, shortName: '*****', longName: 'sehr lang'});
         lstConfigRates['BILDUNG'] = new Array();
         lstConfigRates['BILDUNG'].push({ id: 25, fieldname: 'K_RATE_BILDUNG', value: 0, shortName: '_____', longName: 'nicht eingeschätzt'});
         lstConfigRates['BILDUNG'].push({ id: 26, fieldname: 'K_RATE_BILDUNG', value: 2, shortName: '*____', longName: 'keine'});
         lstConfigRates['BILDUNG'].push({ id: 27, fieldname: 'K_RATE_BILDUNG', value: 8, shortName: '***__', longName: 'informativ'});
         lstConfigRates['BILDUNG'].push({ id: 28, fieldname: 'K_RATE_BILDUNG', value: 11, shortName: '****_', longName: 'bildend'});
         lstConfigRates['GESAMT'] = new Array();
         lstConfigRates['GESAMT'].push({ id: 41, fieldname: 'K_RATE_GESAMT', value: 0, shortName: '_____', longName: 'nicht eingeschätzt'});
         lstConfigRates['GESAMT'].push({ id: 42, fieldname: 'K_RATE_GESAMT', value: 2, shortName: '*____', longName: 'nicht so schön'});
         lstConfigRates['GESAMT'].push({ id: 43, fieldname: 'K_RATE_GESAMT', value: 5, shortName: '**___', longName: 'ansehen, wenn Langeweile'});
         lstConfigRates['GESAMT'].push({ id: 44, fieldname: 'K_RATE_GESAMT', value: 8, shortName: '***__', longName: 'empfehlenswert'});
         lstConfigRates['GESAMT'].push({ id: 45, fieldname: 'K_RATE_GESAMT', value: 11, shortName: '****_', longName: 'muß man gesehen haben'});
         lstConfigRates['GESAMT'].push({ id: 46, fieldname: 'K_RATE_GESAMT', value: 14, shortName: '*****', longName: 'phantastischer Meilenstein'});
         lstConfigRates['KRAFT'] = new Array();
         lstConfigRates['KRAFT'].push({ id: 13, fieldname: 'K_RATE_KRAFT', value: 0, shortName: '_____', longName: 'nicht eingeschätzt'});
         lstConfigRates['KRAFT'].push({ id: 14, fieldname: 'K_RATE_KRAFT', value: 2, shortName: '*____', longName: 'schafft jeder'});
         lstConfigRates['KRAFT'].push({ id: 15, fieldname: 'K_RATE_KRAFT', value: 5, shortName: '**___', longName: 'leicht'});
         lstConfigRates['KRAFT'].push({ id: 16, fieldname: 'K_RATE_KRAFT', value: 8, shortName: '***__', longName: 'mittel'});
         lstConfigRates['KRAFT'].push({ id: 17, fieldname: 'K_RATE_KRAFT', value: 11, shortName: '****_', longName: 'schwer'});
         lstConfigRates['KRAFT'].push({ id: 18, fieldname: 'K_RATE_KRAFT', value: 14, shortName: '*****', longName: 'sehr schwer'});
         lstConfigRates['MENTAL'] = new Array();
         lstConfigRates['MENTAL'].push({ id: 19, fieldname: 'K_RATE_MENTAL', value: 0, shortName: '_____', longName: 'nicht eingeschätzt'});
         lstConfigRates['MENTAL'].push({ id: 20, fieldname: 'K_RATE_MENTAL', value: 2, shortName: '*____', longName: 'schafft jeder'});
         lstConfigRates['MENTAL'].push({ id: 21, fieldname: 'K_RATE_MENTAL', value: 5, shortName: '**___', longName: 'problemlos'});
         lstConfigRates['MENTAL'].push({ id: 22, fieldname: 'K_RATE_MENTAL', value: 8, shortName: '***__', longName: 'kostet Überwindung'});
         lstConfigRates['MENTAL'].push({ id: 23, fieldname: 'K_RATE_MENTAL', value: 11, shortName: '****_', longName: 'gefährlich'});
         lstConfigRates['MENTAL'].push({ id: 24, fieldname: 'K_RATE_MENTAL', value: 14, shortName: '*****', longName: 'zittrig'});
         lstConfigRates['MOTIVE'] = new Array();
         lstConfigRates['MOTIVE'].push({ id: 29, fieldname: 'K_RATE_MOTIVE', value: 0, shortName: '_____', longName: 'nicht eingeschätzt'});
         lstConfigRates['MOTIVE'].push({ id: 30, fieldname: 'K_RATE_MOTIVE', value: 2, shortName: '*____', longName: 'nichts anzusehen'});
         lstConfigRates['MOTIVE'].push({ id: 31, fieldname: 'K_RATE_MOTIVE', value: 5, shortName: '**___', longName: 'nichts Besonderes'});
         lstConfigRates['MOTIVE'].push({ id: 32, fieldname: 'K_RATE_MOTIVE', value: 8, shortName: '***__', longName: 'einzelne schöne Motive'});
         lstConfigRates['MOTIVE'].push({ id: 33, fieldname: 'K_RATE_MOTIVE', value: 11, shortName: '****_', longName: 'sehr schöne Motive'});
         lstConfigRates['MOTIVE'].push({ id: 34, fieldname: 'K_RATE_MOTIVE', value: 14, shortName: '*****', longName: 'phantastische Motive'});
         lstConfigRates['SCHWIERIGKEIT'] = new Array();
         lstConfigRates['SCHWIERIGKEIT'].push({ id: 1, fieldname: 'K_RATE_SCHWIERIGKEIT', value: 0, shortName: '______', longName: 'nicht eingeschätzt'});
         lstConfigRates['SCHWIERIGKEIT'].push({ id: 2, fieldname: 'K_RATE_SCHWIERIGKEIT', value: 2, shortName: '*____', longName: 'keine'});
         lstConfigRates['SCHWIERIGKEIT'].push({ id: 3, fieldname: 'K_RATE_SCHWIERIGKEIT', value: 5, shortName: '**___', longName: 'ein Spaziergang'});
         lstConfigRates['SCHWIERIGKEIT'].push({ id: 4, fieldname: 'K_RATE_SCHWIERIGKEIT', value: 8, shortName: '***__', longName: 'nicht für jedermann'});
         lstConfigRates['SCHWIERIGKEIT'].push({ id: 5, fieldname: 'K_RATE_SCHWIERIGKEIT', value: 11, shortName: '****_', longName: 'Tour'});
         lstConfigRates['SCHWIERIGKEIT'].push({ id: 6, fieldname: 'K_RATE_SCHWIERIGKEIT', value: 14, shortName: '*****', longName: 'Extrem'});
         lstConfigRates['WICHTIGKEIT'] = new Array();
         lstConfigRates['WICHTIGKEIT'].push({ id: 35, fieldname: 'K_RATE_WICHTIGKEIT', value: 0, shortName: '_____', longName: 'nicht eingeschätzt'});
         lstConfigRates['WICHTIGKEIT'].push({ id: 36, fieldname: 'K_RATE_WICHTIGKEIT', value: 2, shortName: '*____', longName: 'nie wieder'});
         lstConfigRates['WICHTIGKEIT'].push({ id: 37, fieldname: 'K_RATE_WICHTIGKEIT', value: 5, shortName: '**___', longName: 'unwichtig'});
         lstConfigRates['WICHTIGKEIT'].push({ id: 38, fieldname: 'K_RATE_WICHTIGKEIT', value: 8, shortName: '***__', longName: 'fand ich OK'});
         lstConfigRates['WICHTIGKEIT'].push({ id: 39, fieldname: 'K_RATE_WICHTIGKEIT', value: 11, shortName: '****_', longName: 'war mir wichtig'});
         lstConfigRates['WICHTIGKEIT'].push({ id: 40, fieldname: 'K_RATE_WICHTIGKEIT', value: 14, shortName: '*****', longName: 'ein Meilenstein'});
         lstConfigRates['TYPE'] = new Array();
         lstConfigRates['TYPE'].push({ id: 66, fieldname: 'K_TYPE', value: 0, shortName: '?', longName: 'OFFEN'});
         lstConfigRates['TYPE'].push({ id: 112, fieldname: 'K_TYPE', value: 106, shortName: 'Auto', longName: 'Autofahrt'});
         lstConfigRates['TYPE'].push({ id: 51, fieldname: 'K_TYPE', value: 5, shortName: 'Ba', longName: 'Baden'});
         lstConfigRates['TYPE'].push({ id: 113, fieldname: 'K_TYPE', value: 130, shortName: 'Biw', longName: 'Biwak'});
         lstConfigRates['TYPE'].push({ id: 50, fieldname: 'K_TYPE', value: 4, shortName: 'Bo', longName: 'Boots-Tour'});
         lstConfigRates['TYPE'].push({ id: 61, fieldname: 'K_TYPE', value: 122, shortName: 'BT', longName: 'Berg-Tour'});
         lstConfigRates['TYPE'].push({ id: 60, fieldname: 'K_TYPE', value: 121, shortName: 'BW', longName: 'Berg-Wanderung'});
         lstConfigRates['TYPE'].push({ id: 58, fieldname: 'K_TYPE', value: 111, shortName: 'Ga', longName: 'Gassi-Runde'});
         lstConfigRates['TYPE'].push({ id: 65, fieldname: 'K_TYPE', value: 126, shortName: 'HT', longName: 'Hochtour'});
         lstConfigRates['TYPE'].push({ id: 64, fieldname: 'K_TYPE', value: 125, shortName: 'KB', longName: 'kombinierte Berg-Tour'});
         lstConfigRates['TYPE'].push({ id: 67, fieldname: 'K_TYPE', value: 127, shortName: 'KlAp', longName: 'Alpinklettern'});
         lstConfigRates['TYPE'].push({ id: 68, fieldname: 'K_TYPE', value: 128, shortName: 'KlSa', longName: 'Sachsenklettern'});
         lstConfigRates['TYPE'].push({ id: 69, fieldname: 'K_TYPE', value: 129, shortName: 'KlSp', longName: 'Sportklettern'});
         lstConfigRates['TYPE'].push({ id: 49, fieldname: 'K_TYPE', value: 3, shortName: 'KlT', longName: 'Kletter-Tour'});
         lstConfigRates['TYPE'].push({ id: 62, fieldname: 'K_TYPE', value: 123, shortName: 'KS', longName: 'Klettersteig-Tour'});
         lstConfigRates['TYPE'].push({ id: 54, fieldname: 'K_TYPE', value: 103, shortName: 'Mu', longName: 'Museumsbesichtigung'});
         lstConfigRates['TYPE'].push({ id: 56, fieldname: 'K_TYPE', value: 105, shortName: 'PB', longName: 'Park-Besuch'});
         lstConfigRates['TYPE'].push({ id: 47, fieldname: 'K_TYPE', value: 1, shortName: 'RT', longName: 'Rad-Tour'});
         lstConfigRates['TYPE'].push({ id: 63, fieldname: 'K_TYPE', value: 124, shortName: 'ScT', longName: 'Schneeschuh-Tour'});
         lstConfigRates['TYPE'].push({ id: 48, fieldname: 'K_TYPE', value: 2, shortName: 'SkT', longName: 'Skating-Tour'});
         lstConfigRates['TYPE'].push({ id: 57, fieldname: 'K_TYPE', value: 110, shortName: 'Spa', longName: 'Spaziergang'});
         lstConfigRates['TYPE'].push({ id: 52, fieldname: 'K_TYPE', value: 101, shortName: 'StBe', longName: 'Stadtbesichtigung'});
         lstConfigRates['TYPE'].push({ id: 53, fieldname: 'K_TYPE', value: 102, shortName: 'StBu', longName: 'Stadtbummel'});
         lstConfigRates['TYPE'].push({ id: 114, fieldname: 'K_TYPE', value: 131, shortName: 'Unt', longName: 'Unterkunft'});
         lstConfigRates['TYPE'].push({ id: 59, fieldname: 'K_TYPE', value: 120, shortName: 'W', longName: 'Wanderung'});
         lstConfigRates['TYPE'].push({ id: 55, fieldname: 'K_TYPE', value: 104, shortName: 'Z', longName: 'Zoo-Besuch'});

         // set config
         configContainer.configRates = lstConfigRates;
         configContainer.flgConfigRatesLoaded = true;
     }

     function loadExampleData(dataContainer) {
         var lstData = dataContainer.data;
         lstData.push({
                     Path : 'D:/Bilder/digifotos/import-2013-01/20130428-berkenbrueck',
                     Ort : 'Berkenbrueck',
                     StartDate : '28.04.2013 12:12:43',
                     EndDate : '28.04.2013 15:08:42',
                     Name : 'Rundwanderung mit Harry im Fläming über die Felder von Berkenbrueck nach Gottsdorf 28.04.2013',
                     Personen : 'Harry',
                     Keywords : ',KW_Wald,KW_Teich,KW_See,KW_Bach,KW_Moor,KW_Feld,KW_Wiese,KW_Weide,KW_Kulturlandschaft,KW_Landschaft,KW_Natur,KW_Naturlandschaft,KW_Wandern,KW_Wanderung,KW_Kurztour,KW_heiter,KW_Sonne,KW_sonnig,KW_Frühling',
                     MyOrt : 'Berkenbrueck',
                     MyStartDate : '28.04.2013 12:12:43',
                     MyEndDate : '28.04.2013 15:08:42'
                 });
         lstData.push({
                     Path : 'D:/Bilder/digifotos/import-2013-01/20130428-mittenwalde',
                     Ort : 'Mittenwalde',
                     StartDate : '28.04.2013 19:22:41',
                     EndDate : '28.04.2013 20:17:41',
                     Name : 'Gassi-Runde mit Harry,Verena über die Felder bei Mittenwalde 28.04.2013',
                     Personen : 'Harry,Verena',
                     Keywords : ',KW_Bach,KW_Feld,KW_Blumen,KW_Wiese,KW_Kulturlandschaft,KW_Landschaft,KW_Natur,KW_Spaziergang,KW_Gassi,KW_Kurztour,KW_heiter,KW_Sonne,KW_sonnig,KW_Frühling,KW_Sonnenuntergang',
                     MyOrt : 'Mittenwalde',
                     MyStartDate : '28.04.2013 19:22:41',
                     MyEndDate : '28.04.2013 20:17:41'
                 });

         dataContainer.flgDataLoaded = true;
     }
     
</script>

<style>
/*
########################
##
## Base-Styles
##
########################
*/
body {
    font-family: Verdana,Arial,Helvetica,sans-serif;
    font-size: 11px;
    text-align: left;
}

.button {
    height: 25px;
    text-decoration: none;
/*    width: 150px; */
    padding: 2px;
    border: 2px solid white; /*#336699;*/
    border-radius: 4px;
    text-align: center;
    color: white;
    font-weight: bold;
    background-color: #8CACD3;
    background: #8cacd3; /* Old browsers */
    background: -moz-linear-gradient(top, #8cacd3 0%, #2989d8 50%, #468ec9 51%, #7db9e8 100%); /* FF3.6+ */
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#8cacd3), color-stop(50%,#2989d8), color-stop(51%,#468ec9), color-stop(100%,#7db9e8)); /* Chrome,Safari4+ */
    background: -webkit-linear-gradient(top, #8cacd3 0%,#2989d8 50%,#468ec9 51%,#7db9e8 100%); /* Chrome10+,Safari5.1+ */
    background: -o-linear-gradient(top, #8cacd3 0%,#2989d8 50%,#468ec9 51%,#7db9e8 100%); /* Opera 11.10+ */
    background: -ms-linear-gradient(top, #8cacd3 0%,#2989d8 50%,#468ec9 51%,#7db9e8 100%); /* IE10+ */
    background: linear-gradient(to bottom, #8cacd3 0%,#2989d8 50%,#468ec9 51%,#7db9e8 100%); /* W3C */
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#8cacd3', endColorstr='#7db9e8',GradientType=0 ); /* IE6-9 */
}


.optionfavorite {
    font-size: 12px;
    font-weight: bold;
}

.optionactive {
    font-size: 14px;
    font-weight: bold;
}
.optionnorm {
    font-size: 10px;
    font-weight: normal;
}

input:active, input:focus, select:active, select:focus, textarea:active, textarea:focus {
    font-size: 14px;
    background-color: #FCC546;
}
textarea, input, select {
    font-size: 11px;
    border: 1px solid #8CACD3;
    background-color: #EBF3FA;
    border-radius: 4px;
    margin-bottom: 2px;
}


label {
    display:block; 
}
/** insert * behind label with required **/
label.required:after {
  content: '*';
  color: red;
}

/** highlight empty input with required **/
input.required:invalid , textarea.required:invalid, select.required:invalid {
  background: #F96502;
}

/**
  App-Config
**/
#app {
    min-width:800px;
}

#tools {
    background-color: #8CACD3;
    border: 2px solid black;
    float: left;
    width: 100%;
    position: fixed;
    z-index: 21;
}
#toolsDummy{
    height: 40px;
}

.exportLink {
    display: none;
}

span.title {
    font-size: 12px;
    font-weight: bold;
    color: white;
}

#container {
    float: left;
    width: 500px;
    height: 500px;
    overflow-x:auto;
    overflow-y:auto;
}

#contentContainer {
    float: left;
    width: 500px;
    height: 500px;
}
#mapContainer {
    display: none;
    float: left;
    width: 500px;
    height: 500px;
    overflow-x:auto;
    overflow-y:auto;
}
#images {
    display: none;
    float: left;
    width: 500px;
    height: 500px;
    overflow-x:auto;
    overflow-y:auto;
}

/** CSS3-Tooltips siehe http://t3n.de/news/css3-individuelle-tooltips-ohne-356353/ **/
a {
  position: relative;
}
/** show content **/
a[data-csstooltip]:before {
  position: absolute;
  left: 0px;
  top: -40px;
  background-color: #ff0000;
  color: #ffffff;
  height: 30px;
  line-height: 30px;
  border-radius: 5px;
  padding: 0 15px;
  content: attr(data-csstooltip);
  white-space: nowrap;
  display: none;
}
/** show arrow **/
a[data-csstooltip]:after {
  position: absolute;
  left: 15px;
  top: -10px;
  border-top: 7px solid #ff0000;
  border-left: 7px solid transparent;
  border-right: 7px solid transparent;
  content: "";
  display: none;
}
/** when hover **/
a[data-csstooltip]:hover:after, a[data-csstooltip]:hover:before {
  display: block;
}
/** Head **/
.head_line {
    display: none;
    background-color: #8CACD3;
    border: 2px solid black;
    float: left;
    width: 500px;
    position: fixed;
    z-index: 21;
}
.head_block {
    border: 1px thin black;
    float: left;
}
.head_column {
    border: 1px dotted blue;
    float: left;
}
.label_head_column {
    display: none;
}
.headLineDummy{
    display: none;
    height: 160px;
}

/** Content **/
.content_line {
    border: 2px solid black;
    float: left;
    width: 500px;
    margin-top: 10px;
}
.content_line_ue {
    float: left;
}
.content_line_datacontainer {
    float: left;
}
.content_block {
    float: left;
}
.content_block_ue {
    border-top: 1px solid black;
    clear: both;
    font-weight: bold;
}
.content_column {
    border: 1px dotted blue;
    float: left;
}


/** Block: Base **/
.block_base {
    clear: both;
    width: 500px;
}
.column_Path {
    width: 490px;
    font-weight: bold;
}
.input_Path {
    width: 400px;
    font-weight: bold;
}

/** Block: Orig **/
.block_vorgabe {
    clear: both;
    width: 500px;
}
.column_StartDate {
    width: 140px;
}
.column_EndDate {
    width: 140px;
}
.column_Ort {
    width: 200px;
}

/** Block: My **/
.block_config {
    clear: both;
    width: 500px;
}
.column_Type {
    width: 200px;
}
.column_Praefix {
    width: 140px;
}
.input_Praefix {
    width: 130px;
}
.column_TimeCorrector {
    width: 140px;
}
.input_TimeCorrector {
    width: 130px;
}
.column_MyOrt {
    width: 200px;
}
.input_MyOrt {
    width: 190px;
}
.column_MyStartDate {
    width: 140px;
}
.input_MyStartDate {
    width: 130px;
}
.column_MyEndDate {
    width: 140px;
}
.input_MyEndDate {
    width: 130px;
}

/** Block: Data **/
.block_data {
    clear: both;
    width: 500px;
}
.column_Name {
    width: 480px;
}
.input_Name {
    width: 400px;
    background: #83F792;
}
.column_Personen {
    width: 480px;
}
.input_Personen {
    width: 440px;
}
.column_Keywords {
    width: 480px;
}
.input_textarea_Keywords {
    width: 400px;
    height: 30px;
}
.input_textarea_Keywords:active, .input_textarea_Keywords:focus {
    height: 120px;
}
.column_Comment {
    width: 480px;
}
.input_textarea_Comment {
    width: 400px;
    height: 20px;
}
.input_textarea_Comment:active, .input_textarea_Comment:focus {
    height: 200px;
}
/** Block: Track **/
.block_track {
    clear: both;
    width: 500px;
}
.column_TrackFile {
    width: 480px;
}
.input_TrackFile {
    width: 300px;
}
.span_TrackFileUploader {
    width: 150px;
    height: 45px;
    padding: 2px;
    border: 2px solid #8CACD3;
    border-radius: 4px;
    text-align: center;
    font-weight: bold;
    color: #0645AD;
    background: #fcf1b5; /* Old browsers */
    background: -moz-radial-gradient(center, ellipse cover,  #fcf1b5 31%, #fefcea 87%); /* FF3.6+ */
    background: -webkit-gradient(radial, center center, 0px, center center, 100%, color-stop(31%,#fcf1b5), color-stop(87%,#fefcea)); /* Chrome,Safari4+ */
    background: -webkit-radial-gradient(center, ellipse cover,  #fcf1b5 31%,#fefcea 87%); /* Chrome10+,Safari5.1+ */
    background: -o-radial-gradient(center, ellipse cover,  #fcf1b5 31%,#fefcea 87%); /* Opera 12+ */
    background: -ms-radial-gradient(center, ellipse cover,  #fcf1b5 31%,#fefcea 87%); /* IE10+ */
    background: radial-gradient(ellipse at center,  #fcf1b5 31%,#fefcea 87%); /* W3C */
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fcf1b5', endColorstr='#fefcea',GradientType=1 ); /* IE6-9 fallback on horizontal gradient */
}
.column_Track {
    width: 480px;
}
.input_textarea_Track {
    width: 400px;
    height: 40px;
    white-space: pre;
    word-wrap: normal;
    overflow-x: scroll;
    font-size: 9px;
}
.input_textarea_Track:active, .input_textarea_Track:focus {
    height: 200px;
    font-size: 9px;
}
.column_TrackStartDate {
    width: 175px;
}
.input_TrackStartDate {
    width: 130px;
}
.column_TrackEndDate {
    width: 175px;
}
.input_TrackEndDate {
    width: 130px;
}
.column_TrackTimeCorrector {
    width: 140px;
}
.input_TrackTimeCorrector {
    width: 130px;
}
.column_Dist {
    clear: both;
    width: 110px;
}
.input_Dist {
    width: 100px;
}
.column_AltMin {
    width: 110px;
}
.input_AltMin {
    width: 100px;
}
.column_AltMax {
    width: 110px;
}
.input_AltMax {
    width: 100px;
}
.column_AltAsc {
    clear: both;
    width: 110px;
}
.input_AltAsc {
    width: 100px;
}
.column_AltDesc {
    width: 110px;
}
.input_AltDesc {
    width: 100px;
}
.column_AltStart {
    width: 110px;
}
.input_AltStart {
    width: 100px;
}
.column_AltEnd {
    width: 110px;
}
.input_AltEnd {
    width: 100px;
}

/** Block: Rate **/
.block_rate {
    clear: both;
    width: 500px;
}
.column_SCHWIERIGKEIT {
    width: 240px;
}
.column_AUSDAUER {
    width: 240px;
}
.column_KRAFT {
    width: 240px;
}
.column_MENTAL {
    width: 240px;
}
.column_GESAMT {
    clear: both;
    width: 240px;
}
.column_WICHTIGKEIT {
    width: 240px;
}
.column_MOTIVE {
    width: 240px;
}
.column_BILDUNG {
    width: 240px;
}



/** Keywords-Editor **/
.rowStart_container {
    clear: both;
    float: left;
    margin: 0;
    padding-top: 6px;
    width: 100%;
}
.label_container {
    border: 0 solid #FF0000;
    float: left;
    width: 70px;
}
.textShow_container {
    float: left;
    width: 350px;
}
#divKeywordsEditor {
   display: none;
   width: 500px;
   position: fixed;
   z-index: 25;
   background: white;
   border: 2px solid #8cacd3;
   padding: 4px;
}

/*
########################
# Toggler
########################
*/
.blockToggler {
   float: right;
   display: block;
}

.togglecontainer {
    float: left;
}

.togglecontainer-formfilter {
    width: 100%;
}

.icon-blocktoggler {
    border: none;
    width: 19px;
}

</style>

<!-- JQuery Tools -->
<script type="text/javascript" src="http://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
<script type="text/javascript">

    // overload tooltip from title as seen on http://stackoverflow.com/questions/15734105/jquery-ui-tooltip-does-not-support-html-content
    $("[data-tooltip]").each(function(i, e) {
        var tag = $(e);
        if (tag.is("[title]") === false) {
            tag.attr("title", "");
        }
    });

    $(document).tooltip({
        items: "[data-tooltip]",
        content: function () {
            return $(this).attr("data-tooltip");
        }
    });
</script>
<style>
/* Component containers
----------------------------------*/
.ui-widget-content {
	background: #ffffff url("images/ui-bg_flat_75_ffffff_40x100.png") 50% 50% repeat-x;
	color: #222222;
}
.ui-widget-content a {
	color: #222222;
}
.ui-widget-header {
	background: #cccccc url("images/ui-bg_highlight-soft_75_cccccc_1x100.png") 50% 50% repeat-x;
	color: #222222;
}
.ui-widget-header a {
	color: #222222;
}

.ui-tooltip {
	padding: 8px;
	position: absolute;
	z-index: 9999;
	max-width: 300px;
	-webkit-box-shadow: 0 0 5px #aaa;
	box-shadow: 0 0 5px #aaa;
    background: #CAF1F7;
}
body .ui-tooltip {
	border-width: 2px;
}
</style>


<!-- APIs fuer Maps -->
<script type="text/javascript" src="http://www.michas-ausflugstipps.de/./jsres/OpenLayers-2.11.js"></script>
<script type="text/javascript" src="http://www.michas-ausflugstipps.de/./jsres/OpenStreetMap.js"></script>
<!--<script type="text/javascript" src="http://www.openstreetmap.org/openlayers/OpenStreetMap.js"></script>-->
<script type="text/javascript" src="http://www.michas-ausflugstipps.de/./jsres/jms/JMSGeoMapOpenLayer.js?DUMMY=20130105"></script>

<!-- Charts -->
<!--[if lt IE 9]><script language="javascript" type="text/javascript" src="http://www.michas-ausflugstipps.de/./jqplot/excanvas.js"></script><![endif]-->
<script type="text/javascript" src="http://www.michas-ausflugstipps.de/./jqplot/jquery.jqplot.min.js"></script>
<link rel="stylesheet" type="text/css" href="http://www.michas-ausflugstipps.de//./jqplot/jquery.jqplot.css" />
<script>
    /* 
     * ########################################
     * ###
     * ### Overload Toggler 
     * ###
     * ######################################## 
     */
    /**
     * fuegt FormRowToggler an Elternelement an
     */
    JMATPageLayout.prototype.appendBlockToggler = function(parentId, toggleId) {
        var html = jMATService.getPageLayoutService().createBlockTogglerHtml(toggleId, toggleId, 
                "<img src='http://www.michas-ausflugstipps.de/./images/icon-up.gif' class='icon-blocktoggler icon-blocktoggleron'>", 
                "<img src='http://www.michas-ausflugstipps.de/./images/icon-down.gif' class='icon-blocktoggler icon-blocktogglerof'>", 
                "", "");
        jMATService.getJMSServiceObj().appendHtml(html,parentId, "blockToggler");
    }

    /* 
     * ########################################
     * ###
     * ### Overload GPX-Parser 
     * ###
     * ######################################## 
     */

    /**
     * Parsen der GPX-Daten und Aufruf von objMap.addTour und objMap.addLocation
     * @param doc - XMLDocument
     */
    JMSGeoMapGPXLoad.prototype.parseXMLDocument = function(doc) {
        // Tags definieren
        var constTagNameEle = "ele";
        var constTagNameTime = "time";
        var constTagNameRte = "trkseg";
        var constTagNameRtept = "trkpt";

        if (this.jmsLoggerJMSGeoMapGPXLoad && this.jmsLoggerJMSGeoMapGPXLoad.isDebug) 
            this.jmsLoggerJMSGeoMapGPXLoad.logDebug("JMSGeoMapGPXLoad.parseXMLDocument me:" 
                    + this + " url:" + this.url);
        if (doc) {
            /* Tracks extrahieren
             */
            var lstTags = doc.getElementsByTagName(constTagNameRte);
            if (this.jmsLoggerJMSGeoMapGPXLoad && this.jmsLoggerJMSGeoMapGPXLoad.isDebug) 
                this.jmsLoggerJMSGeoMapGPXLoad.logDebug("JMSGeoMapGPXLoad.parseXMLDocument valid document parsing Tracks me:" 
                        + this + " url:" + this.url + " LstRTE:" + lstTags.length);
            var lstFeatures = [];

            // Tags durchlaufen
            for (var i = 0; i< lstTags.length; i++) {
                
                var color = this.getJMSGeoMapObj().randomColor();
                var tag = lstTags[i];
                var lstChildTags = tag.childNodes;
                var startPoint = null;
                var pointList = [];
                var title = "Route";
                var description = "Keine Beschreibung.";

                // Kindselemente durchlaufen
                for (var j = 0; j < lstChildTags.length; j++) {
                    var childTag = lstChildTags[j];
                    var nodeName = childTag.nodeName;

                    // Eigenschaften auswerten
                    switch (nodeName) {
                    case 'topografix:color':
                        // Farbe
                        color = OpenLayers.Util.getXmlNodeValue(childTag);
                        break;
                    case 'color':
                        // Farbe
                        color = OpenLayers.Util.getXmlNodeValue(childTag);
                        break;
                    case constTagNameRtept:
                        // Trackpunkte extrahieren und OpenLayer-Track anlegen

                        // Farbe lesen  
                        if (color == '')
                            color=this.getJMSGeoMapObj().randomColor();

                        // Koordinaten anlegen
                        if (childTag.getAttribute('lat') && childTag.getAttribute('lon')) {
                            // Hoehe und Zeit aus Kindeslementen lesen
                            var ele = 0;
                            var time = null;

                            // Kindselemente durchlaufen
                            var lstTrkpChildTags = childTag.childNodes;
                            for (var k = 0; k < lstTrkpChildTags.length; k++) {
                                var trkpChildTag = lstTrkpChildTags[k];
                                var trkpNodeName = trkpChildTag.nodeName;
                                // Eigenschaften auswerten
                                switch (trkpNodeName) {
                                case constTagNameEle:
                                    // Hoehe
                                    ele = OpenLayers.Util.getXmlNodeValue(trkpChildTag);
                                    break;
                                case constTagNameTime:
                                    // Zeit: 2012-08-24T17:55:00Z
                                    time = OpenLayers.Util.getXmlNodeValue(trkpChildTag);                               
                                    //var strDate = time;
                                    //var dateParts = strDate.split("-");
                                    //var date = new Date(dateParts[2], (dateParts[1] - 1), dateParts[0]);
                                    break;
                                default:
                                    // alert('unknown ' + trkNodeName);
                                    break;
                                }
                            }

                            //Punkt anlegen
                            var point = 
                                this.getJMSGeoMapObj().createJMSGeoLatLonObj(
                                        childTag.getAttribute('lat'), 
                                        childTag.getAttribute('lon'), 
                                        ele, 
                                        time);
                            if (!startPoint) startPoint = point;
                            pointList.push(point);
                        }
                        break;
                    case 'name':
                        title = OpenLayers.Util.getXmlNodeValue(childTag);
                        break;
                    case 'desc':
                        description = OpenLayers.Util.getXmlNodeValue(childTag);
                        if (description) description = description.replace(/\n/g, "<br>");
                        break;
                    default:
                        // alert('unknown ' + nodeName);
                        break;
                    }
                }
                // Tour anlegen
                if (this.jmsLoggerJMSGeoMapGPXLoad && this.jmsLoggerJMSGeoMapGPXLoad.isDebug) 
                    this.jmsLoggerJMSGeoMapGPXLoad.logDebug("JMSGeoMapGPXLoad.parseXMLDocument add Track me:" 
                            + this + " url:" + this.url + " title:" + title 
                            + " start:" + geoPoint + " color:" + color);
                this.getJMSGeoMapObj().addTour(null, this.strNameLayer, title, 
                        description, startPoint, pointList,
                        {
                            color: color,
                            loadInfoWindowType: JMSGeoMapFeature.TYPE_LOADINFOWINDOW_LOCAL
                        }
                );
            }
        }

        return 0;
    };

     /* 
      * ########################################
      * ###
      * ### Map
      * ###
      * ######################################## 
      */

    // map-Vars
    var mapMP = null;
    var map = null;
    var msChartObj = null;

    function initMap() {
        // config
        var mapDivName = "mapDiv";
        var pos = new JMSGeoLatLon(49.32667, 11.02);
        var zoom = 10;
        var globOptions = {
            supressLoadingOnMoveEnd: 1,
            supressImageLoading: 1,
            supressTourLoading: 1,
            supressTrackLoading: 0,
            supressLocationLoading: 1,
            MAPOPTIONS_OPENLAYERS: {
            }
        };

        // create Map
        mapMP = new JMSGeoMapOpenLayer(mapDivName, globOptions);
        mapMP.createMapObj();

        // add Defaultlayer
        mapMP.addDefaultLayer();

        // add OsmOrts-Suche
        //mapMP.addOsmLocSearch('mapMP');

        // add Default-Controls
        //mapMP.addDefaultControls();

        // center
        mapMP.setCenter(pos, zoom);

        // add View-Rectangle
        mapMP.setViewRectangle("mplayer", 0.35, 0.35);

        // add MP-Controls (toggle Features, Ortsuche, FullScreen)
        //mapMP.addJMSGeoMapFeatureControls();
    }


    function loadMap(trackContent) {

        var urlGPX = "localtrack_from_input";

        // parse if it is a string
        if (typeof trackContent == "string") {
            trackContent = OpenLayers.parseXMLString(trackContent);
        }
        
        // remove old charts
        $('chartdiv').html("");

        // load Chart
        msChartObj = new JMSGeoProfile('chartdiv');
        var statusInfoText = "Lade Daten vom Server";
        var mpChartGPXLoad = new JMSGeoMapGPXLoad(msChartObj, "mplayer", urlGPX, statusInfoText);
        mpChartGPXLoad.parseXMLDocument(trackContent);

        // remove old tracks
        mapMP.removeJMSGeoMapFeatures("TOUR");
        mapMP.removeJMSGeoMapFeatures("TRACK");

        // load Map
        var mpGPXLoad = new JMSGeoMapGPXLoad(mapMP, "mplayer", urlGPX, statusInfoText);
        mpGPXLoad.parseXMLDocument(trackContent);
        map = mapMP;

        // load tracks aso
        var showLoadInfo = 1;
        var statusInfoText = "";
        if (showLoadInfo) {
            statusInfoText = "Lade Touren-Daten vom Server. Das kann dauern ;-)";
        }

        // center to Feature
        var delayedCenter = window.setInterval(
            function() {
                // wait 4 seconds for loading
                window.clearInterval(delayedCenter);

                // center
                var mpFeatureObj = null;
                var tmpHash = mapMP.hshFeature["TOUR"];
                if (tmpHash) {
                    for (var i in tmpHash) {
                        mpFeatureObj = tmpHash[i];
                        if (! mapMP.isEmpty(mpFeatureObj) && mpFeatureObj) {
                            mpFeatureObj.centerMapOnFeature(mapMP, 14, 1);
                        }
                    }
                }
                
                // output Tourdata
                $("#data_asc").html((mpFeatureObj.metaAsc ? mpFeatureObj.metaAsc.toFixed(0) : ""));
                $("#data_desc").html((mpFeatureObj.metaDesc ? mpFeatureObj.metaDesc.toFixed(0) : ""));
                $("#data_dist").html((mpFeatureObj.metaDist ? mpFeatureObj.metaDist.toFixed(1) : ""));
                $("#data_min").html(mpFeatureObj.getBoundsJMSGeoLatLon()[0].flEle.toFixed(0));
                $("#data_max").html(mpFeatureObj.getBoundsJMSGeoLatLon()[1].flEle.toFixed(0));
                
                // get first and last
                var arrPoints = mpFeatureObj.getArrJMSGeoLatLon();
                var firstPoint = arrPoints[0];
                $("#data_elestart").html(firstPoint.flEle.toFixed(0));
                $("#data_datestart").html(formatGpxDateAsString(firstPoint.time));
                var lastPoint = arrPoints.pop();
                arrPoints.push(lastPoint);
                $("#data_eleend").html(lastPoint.flEle.toFixed(0));
                $("#data_dateend").html(formatGpxDateAsString(lastPoint.time));
            }, 4000);
    }
</script>
<style type="text/css">
/*
########################
##
## Map-Styles
##
########################
v\:* {
  behavior:url(#default#VML);
}

.olControlAttribution {
font-size: smaller;
right: 3px;
top: 1000px;
color: #000000;
}

/* JMSGeoMap-Styles */
.olPanelJMSGeoMapFeatures {
    left: auto;
    right: 8px;
    top: auto;
    bottom: 8px;
}
.olPanelJMSGeoMapFeatures div {
    width:  60px;
    height: 20px;
}
div.PanelButtonJMSGeoMapFeaturesTourItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_tour_aktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesTourItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_tour_inaktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesImageItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_image_aktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesImageItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_image_inaktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesTrackItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_track_aktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesTrackItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_track_inaktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesLocationItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_location_aktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesLocationItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_location_inaktiv.gif");
}
div.PanelButtonFullScreenItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_fullscreen_aktiv.gif");
}
div.PanelButtonFullScreenItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_fullscreen_aktiv.gif");
}
div.PanelButtonOsmSearchItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_osmsearch_aktiv.gif");
}
div.PanelButtonOsmSearchItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_osmsearch_aktiv.gif");
}
div.osm_search {
    font-size: 9px;
}
div.osm_search_title {
    font-size: 9px;
}
div.osm_search_content {
    font-size: 9px;
}
a.osm_search {
    font-size: 9px;
}
a.osm_search_title {
    font-size: 9px;
}
a.osm_search_content {
    font-size: 9px;
}
</style>



</head>
<body>

<div id="app">
    <div id="tools">
      <span class="title">ImageImportEditor</span>
      <a href="#" id="help" class="button" data-tooltip="Mit dem ImageImportEditor lassen sich die über den ImageDirImportEntryGenerator erzeugten JSON-Dateien mit den Ausflügen bearbeiten. Nach dem Laden der Datei können die Daten der einzelnen Ausflüge angepasst, die Bilder angesehen, die Ausflüge bewertet, sowie mit Garmin-GPX-Tracks und den daraus auslesbaren Daten vervollständigt werden.  Anschließend können die Daten wieder als JSON zwischengespeichert, als Batch-Datei zum Import in die MAT-MediadDB und als SQL-Update für die Vervollständigung der MAT-MediadDB exportiert werden.">Help!</a> 
      <input type="file" id="importJSONFile" name="importJSONFile" value="Import JSON" />
      <a href="#" id="exportJSONLink" class="button exportLink" data-tooltip="Export der Daten im JSON-Format zur Zwischenspeicherung">Export as JSON</a> 
      <a href="#" id="exportBatchLink" class="button exportLink" data-tooltip="Generierung der Batch-Import-Befehle für die MAT-MediadDB">Export as Batch</a>
      <a href="#" id="exportSqlLink" class="button exportLink" data-tooltip="Generierung der Sql-Update-Befehle für die MAT-MediadDB">Export as SQL</a>
    </div>
    <div id="toolsDummy"> </div>


    <div class="container" id="container">
    </div>

    <div class="contentContainer" id="contentContainer">
        <div id="mapContainer" class="contentContainer">
           <div id="mapDiv" style="width: 600px; height: 400px"></div>
           <br clear="all">
           <div id="data">
               Asc:<span id="data_asc"></span> Hm
               Desc:<span id="data_desc"></span> Hm
               Dist:<span id="data_dist"></span> km
               Min:<span id="data_min"></span> m
               Max:<span id="data_max"></span> m
               StartEle:<span id="data_elestart"></span> m
               EndEle:<span id="data_eleend"></span> m
               StartDate:<span id="data_datestart"></span>
               EndDate:<span id="data_dateend"></span>
           </div>
           <br clear="all">
           <div id="chartdiv" style="height:200px;width:600px; "></div> 
       </div>
    </div>
    
    <div id="divKeywordsEditor">
    <a href="#" onclick="javascript: $('#divKeywordsEditor').css('display', 'none'); return false; " class="button">Schließen</a>
    </div>
</div>

<script type="text/javascript">
    /* 
     * ########################################
     * ###
     * ### initApp
     * ###
     * ######################################## 
     */

    // set global Vars
    var dataContainer = {
            flgDataLoaded: false,
            data: new Array()
    };
    var configContainer = {
            configName: 'Path',
            configRates: {},
            flgConfigRatesLoaded: false,
            configKeywords: {},
            flgConfigKeywordsLoaded: false,
            configBlocks: {},
            flgConfigBlocksLoaded: false,
    };
    var dataUrl = "example_data.json";
    function loadApp(configContainer, dataUrl, dataContainer) {
        // start init when document ready
        $( document ).ready(function() {
            // init config and load data
            loadConfig(configContainer);
            loadDataFromServer(dataUrl, dataContainer)
        });

    }

    function initApp() {
        // wait for config and data loaded
        checkAppDataLoaded = window.setInterval(
            function() {
                // check every second
                if (   configContainer.flgConfigRatesLoaded
                    && configContainer.flgConfigBlocksLoaded
                    && configContainer.flgConfigKeywordsLoaded
                    && dataContainer.flgDataLoaded) {

                    // clear intervall
                    window.clearInterval(checkAppDataLoaded);

                    // run app
                    runApp(configContainer, dataContainer);
                    
                    // toogle all blocks
                    jMATService.getPageLayoutService().doAllBlockToggler(false);
                }
            },
            1000
        );
    }

    
    function initIFrameVersion() {
        console.log("I am the App-Frame:" + window.name);
        var height = window.innerHeight;
        var width = "600px";
        
        // add iframe
        $( "<iframe name='images' id='images' class='images' src=''"
                 + " width='" + width + "'  height='" + height + 
                 "'>").insertAfter( "#mapContainer" );
        // resize container
        $("#container").width("520px");
        
        // load App
        loadApp(configContainer, dataUrl, dataContainer);
        setupAppSize();
        
        // add Map
        initMap();

        // add resize event
        $( window ).resize(function() {
            setupAppSize();
        });    
    }
    
    function setupAppSize() {
        var height = window.innerHeight;
        var width = window.innerWidth;
        
        console.log("setup size width:" + window.innerWidth 
                + " height:" + window.innerHeight);
        
        if (width > ($("#container").width() + 200)) {
            $("#app").width(width);
            console.log("setup new width:" + $("#images").width());
            $("#contentContainer").width(width - $("#container").width() - 30);
            $("#mapContainer").width(width - $("#container").width() - 30);
            $("#images").width(width - $("#container").width() - 30);
        }
        if (height > 400) {
            $("#app").height(height);
            console.log("setup new height:" + $("#images").height());
            $("#container").height(height - 30);
            $("#contentContainer").height(height - 30);
            $("#mapContainer").height(height - 30);
            $("#images").height(height - 30);
        }
    }
    
    
</script>

<script>

    console.log("start all:" + window.name);
    $( document ).ready(function() {
        initIFrameVersion();
    });
</script>

</body>
</html>